System.register(["./chunk-vendor.js","./chunk-frameworks.js"],function(x){"use strict";var h,f,l,T,C,F,b,q,_;return{setters:[function(a){h=a.o,f=a.a,l=a.r,T=a.f},function(a){C=a.c,F=a.h,b=a.e,q=a.u,_=a.g}],execute:function(){x("h",z);var a=Object.defineProperty,j=(e,n)=>a(e,"name",{value:n,configurable:!0});let g=[];h(".js-comment-header-actions-deferred-include-fragment",{subscribe:e=>C(e,"loadstart",()=>{const n=e.closest(".js-comment");S(n)},{capture:!1,once:!0})}),h(".js-comment .contains-task-list",{add:e=>{const n=e.closest(".js-comment");S(n)}}),f("click",".js-comment-edit-button",function(e){const n=e.currentTarget.closest(".js-comment");n.classList.add("is-comment-editing");const s=L(n);s?s.addEventListener("include-fragment-replaced",()=>v(n),{once:!0}):v(n);const t=e.currentTarget.closest(".js-dropdown-details");t&&t.removeAttribute("open")});function v(e){e.querySelector(".js-write-tab").click();const n=e.querySelector(".js-comment-field");n.focus(),T(n,"change")}j(v,"focusEditForm");function L(e){return e.querySelector(".js-comment-edit-form-deferred-include-fragment")}j(L,"findEditFormDeferredIncludeFragment");function S(e){var n;(n=L(e))==null||n.setAttribute("loading","eager")}j(S,"loadEditFormDeferredIncludeFragment"),f("click",".js-comment-hide-button",function(e){const n=e.currentTarget.closest(".js-comment");E(n,!1);const s=n.querySelector(".js-minimize-comment");s&&s.classList.remove("d-none");const t=e.currentTarget.closest(".js-dropdown-details");t&&t.removeAttribute("open")}),f("click",".js-comment-hide-minimize-form",function(e){e.currentTarget.closest(".js-minimize-comment").classList.add("d-none")});function z(e){const n=e.currentTarget.closest("form"),s=e.currentTarget.getAttribute("data-confirm-text");if(F(n)&&!confirm(s))return!1;for(const o of n.querySelectorAll("input, textarea")){const i=o;i.value=i.defaultValue,i.classList.contains("session-resumable-canceled")&&(i.classList.add("js-session-resumable"),i.classList.remove("session-resumable-canceled"))}const t=e.currentTarget.closest(".js-comment");return t&&t.classList.remove("is-comment-editing"),!0}j(z,"handleCommentCancelButtonClick"),f("click",".js-comment-cancel-button",z),f("click",".js-cancel-issue-edit",function(e){const n=e.currentTarget.closest(".js-details-container");n.querySelector(".js-comment-form-error").hidden=!0}),l(".js-comment-delete, .js-comment .js-comment-update, .js-issue-update, .js-comment-minimize, .js-comment-unminimize",function(e,n,s){const t=e.closest(".js-comment");t.classList.add("is-comment-loading");const o=t.getAttribute("data-body-version");o&&s.headers.set("X-Body-Version",o)}),l(".js-comment .js-comment-update",async function(e,n){let s;const t=e.closest(".js-comment"),o=t.querySelector(".js-comment-update-error"),i=t.querySelector(".js-comment-body-error");o instanceof HTMLElement&&(o.hidden=!0),i instanceof HTMLElement&&(i.hidden=!0),g=[];try{s=await n.json()}catch(d){if(d.response.status===422){const m=JSON.parse(d.response.text);if(m.errors){o instanceof HTMLElement&&(o.textContent=`There was an error posting your comment: ${m.errors.join(", ")}`,o.hidden=!1);return}}else throw d}if(!s)return;const r=s.json;r.errors&&r.errors.length>0&&(g=r.errors,w(i));const y=t.querySelector(".js-comment-body");y&&r.body&&(y.innerHTML=r.body),t.setAttribute("data-body-version",r.newBodyVersion);const u=t.querySelector(".js-body-version");u instanceof HTMLInputElement&&(u.value=r.newBodyVersion);const c=t.querySelector(".js-discussion-poll");c&&r.poll&&(c.innerHTML=r.poll);for(const d of t.querySelectorAll("input, textarea")){const m=d;m.defaultValue=m.value}t.classList.remove("is-comment-stale","is-comment-editing");const p=t.querySelector(".js-comment-edit-history");if(p){const d=await b(document,r.editUrl);p.innerHTML="",p.append(d)}}),h(".js-comment-body-error",{add:e=>{g&&g.length>0&&w(e)}});function w(e){const n=e.querySelector("ol");if(n){n.innerHTML="";const s=g.map(t=>{const o=document.createElement("li");return o.textContent=t,o});for(const t of s)n.appendChild(t)}e.hidden=!1}j(w,"showBodyErrors"),l(".js-comment .js-comment-delete, .js-comment .js-comment-update, .js-comment-minimize, .js-comment-unminimize",async function(e,n){const s=e.closest(".js-comment");try{await n.text()}catch(t){if(t.response.status===422){let o;try{o=JSON.parse(t.response.text)}catch{}o&&o.stale&&s.classList.add("is-comment-stale")}else throw t}s.classList.remove("is-comment-loading")});function E(e,n){const s=e.querySelector(".js-comment-show-on-error");s&&(s.hidden=!n);const t=e.querySelector(".js-comment-hide-on-error");t&&(t.hidden=n)}j(E,"toggleMinimizeError"),l(".js-timeline-comment-unminimize, .js-timeline-comment-minimize",async function(e,n){const s=e.closest(".js-minimize-container");try{const t=await n.html();s.replaceWith(t.html)}catch{E(s,!0)}}),l(".js-discussion-comment-unminimize, .js-discussion-comment-minimize",async function(e,n){const s=e.closest(".js-discussion-comment"),t=s.querySelector(".js-discussion-comment-error");t&&(t.hidden=!0);try{const o=await n.html();s.replaceWith(o.html)}catch(o){if(o.response.status>=400&&o.response.status<500){if(o.response.html){const i=o.response.html.querySelector(".js-discussion-comment").getAttribute("data-error");t instanceof HTMLElement&&(t.textContent=i,t.hidden=!1)}}else throw o}}),l(".js-comment-delete",async function(e,n){await n.json();let s=e.closest(".js-comment-delete-container");s||(s=e.closest(".js-comment-container")||e.closest(".js-line-comments"),s&&s.querySelectorAll(".js-comment").length!==1&&(s=e.closest(".js-comment"))),s.remove()}),l(".js-issue-update",async function(e,n){var s,t,o;const i=e.closest(".js-details-container"),r=i.querySelector(".js-comment-form-error");let y;try{y=await n.json()}catch(c){r.textContent=((o=(t=(s=c.response)==null?void 0:s.json)==null?void 0:t.errors)==null?void 0:o[0])||"Something went wrong. Please try again.",r.hidden=!1}if(!y)return;i.classList.remove("open"),r.hidden=!0;const u=y.json;if(u.issue_title!=null){i.querySelector(".js-issue-title").textContent=u.issue_title;const c=i.closest(".js-issues-results");if(c){if(c.querySelector(".js-merge-pr.is-merging")){const m=c.querySelector(".js-merge-pull-request textarea");m instanceof HTMLTextAreaElement&&m.value===m.defaultValue&&(m.value=m.defaultValue=u.issue_title)}else if(c.querySelector(".js-merge-pr.is-squashing")){const m=c.querySelector(".js-merge-pull-request .js-merge-title");m instanceof HTMLInputElement&&m.value===m.defaultValue&&(m.value=m.defaultValue=u.default_squash_commit_title)}const p=c.querySelector("button[value=merge]");p&&p.setAttribute("data-input-message-value",u.issue_title);const d=c.querySelector("button[value=squash]");d&&d.setAttribute("data-input-title-value",u.default_squash_commit_title)}}document.title=u.page_title;for(const c of e.elements)(c instanceof HTMLInputElement||c instanceof HTMLTextAreaElement)&&(c.defaultValue=c.value)}),l(".js-comment-minimize",async function(e,n){await n.json();const s=e.closest(".js-comment"),t=s.querySelector(".js-minimize-comment");if(t&&t.classList.contains("js-update-minimized-content")){const o=e.querySelector("input[type=submit], button[type=submit]");o&&o.classList.add("disabled");const i=s.closest(".js-comment-container");i&&await q(i)}else{t&&t.classList.add("d-none");const o=e.closest(".unminimized-comment");o.classList.add("d-none"),o.classList.remove("js-comment");const r=e.closest(".js-minimizable-comment-group").querySelector(".minimized-comment");r&&r.classList.remove("d-none"),r&&r.classList.add("js-comment")}}),l(".js-comment-unminimize",async function(e,n){await n.json();const s=e.closest(".js-minimizable-comment-group"),t=s.querySelector(".unminimized-comment"),o=s.querySelector(".minimized-comment");if(t)t.classList.remove("d-none"),t.classList.add("js-comment"),o&&o.classList.add("d-none"),o&&o.classList.remove("js-comment");else{if(o){const r=o.querySelector(".timeline-comment-actions");r&&r.classList.add("d-none"),o.classList.remove("js-comment")}const i=s.closest(".js-comment-container");await q(i)}}),f("details-menu-select",".js-comment-edit-history-menu",e=>{const n=e.detail.relatedTarget.getAttribute("data-edit-history-url");if(!n)return;e.preventDefault();const s=b(document,n);_({content:s,dialogClass:"Box-overlay--wide"})},{capture:!0})}}});
//# sourceMappingURL=chunk-edit-bd8745f9.js.map
