System.register(["./chunk-vendor.js","./chunk-frameworks.js","./chunk-input-demux.js","./chunk-ref-selector.js"],function(){"use strict";var m,D,y,i,b,x,S,_,I,L,M,H;return{setters:[function(d){m=d.a,D=d.r,y=d.o,i=d.t,b=d.c,x=d.T},function(d){S=d.r,_=d.aE,I=d.aD,L=d.t,M=d.g,H=d.e},function(){},function(){}],execute:function(){var d=Object.defineProperty,v=(e,t)=>d(e,"name",{value:t,configurable:!0});m("click",".js-codespaces-update-skus-url",e=>{const t=e.currentTarget;if(!t)return;const o=t.getAttribute("data-refname");if(document.querySelector("form.js-prefetch-codespace-location")&&o){const n=document.querySelector("[data-codespace-skus-url]"),r=n?n.getAttribute("data-codespace-skus-url"):"";if(r){const a=new URL(r,window.location.origin);a.searchParams.set("ref_name",o),n&&n.setAttribute("data-codespace-skus-url",a.toString()),n&&n.setAttribute("data-branch-has-changed","true")}}}),m("remote-input-error","#js-codespaces-repository-select",()=>{const e=document.querySelector("#js-codespaces-unable-load-repositories-warning");e.hidden=!1}),D(".js-new-codespace-form",async function(e,t){const o=e.closest("[data-replace-remote-form-target]"),s=o.querySelector(".js-new-codespace-submit-button");s instanceof HTMLInputElement&&(s.disabled=!0),e.classList.remove("is-error"),e.classList.add("is-loading");try{const n=await t.html();o.replaceWith(n.html)}catch{e.classList.remove("is-loading"),e.classList.add("is-error")}});let $=null;function A(e){$=e,e!==null&&document.querySelector(".js-codespace-loading-steps").setAttribute("data-current-state",$)}v(A,"advanceLoadingState"),y(".js-codespace-loading-steps",{constructor:HTMLElement,add:e=>{const t=e.getAttribute("data-current-state");t&&A(t)}}),y(".js-codespace-advance-state",{constructor:HTMLElement,add:e=>{const t=e.getAttribute("data-state");t&&A(t)}});let B=null;function U(e){D(".js-fetch-cascade-token",async function(t,o){try{B=(await o.json()).json.token}catch{}}),S(e)}v(U,"fetchCascadeToken");function R(e,t,o){if(document.querySelector(e)){const n=Date.now(),a=setInterval(v(()=>{const C=Date.now()-n;if(B||C>=o){clearInterval(a),t(B||void 0);return}},"checkToken"),50)}}v(R,"waitForCascadeTokenWithTimeout"),y(".js-auto-submit-form",{constructor:HTMLFormElement,initialize:S}),y(".js-workbench-form-container",{constructor:HTMLElement,add:e=>{const t=e.querySelector(".js-cascade-token");V(e,t)}});function V(e,t){if(t.value!==""){const o=e.querySelector("form");S(o)}else{const o=document.querySelector(".js-fetch-cascade-token");U(o),R(".js-workbench-form-container",W,1e4)}}v(V,"resolveCascadeToken");function W(e){const t=document.querySelector(".js-workbench-form-container form");t&&e?(X(t,e),N(t,e),S(t)):A("failed")}v(W,"insertCodespaceTokenIntoShowAuthForm");function X(e,t){const o=e.querySelector(".js-cascade-token");o&&o.setAttribute("value",t)}v(X,"insertCodespaceTokenIntoCascadeField");function N(e,t){const o=e.querySelector(".js-partner-info");if(o){let s=o.getAttribute("value");s&&(s=s.replace("%CASCADE_TOKEN_PLACEHOLDER%",t),o.setAttribute("value",s))}}v(N,"insertCodespaceTokenIntoPartnerInfo");var z=Object.defineProperty,te=Object.getOwnPropertyDescriptor,oe=(e,t)=>z(e,"name",{value:t,configurable:!0}),l=(e,t,o,s)=>{for(var n=s>1?void 0:s?te(t,o):t,r=e.length-1,a;r>=0;r--)(a=e[r])&&(n=(s?a(t,o,n):a(n))||n);return s&&n&&z(t,o,n),n};let c=class extends HTMLElement{async connectedCallback(){const e=this.formForLocations();if(e){const t=await _(e,!this.vscsLocationList);this.updatePickableLocations(t)}}formForLocations(){return this.advancedOptionsForm||this.createCodespaceForm}toggleLoadingVscode(){const e=this.loadingVscode.hidden,t=this.children;for(let o=0;o<t.length;o++)t[o].hidden=e;this.loadingVscode.hidden=!e}machineTypeSelected(e){const o=e.currentTarget.getAttribute("data-sku-name");this.skuNameInput&&o&&(this.skuNameInput.value=o),this.advancedOptionsForm&&this.advancedOptionsForm.requestSubmit()}pollForVscode(e){this.toggleLoadingVscode();const t=e.currentTarget.getAttribute("data-src");t&&this.vscodePoller.setAttribute("src",t)}async updatePickableLocations(e){const t=this.formForLocations();if(!e&&t){const n=t.getAttribute("data-codespace-locations-url");if(!n)return;e=await I(n)}const o=e.current,s=e.available;this.hideUnavailableLocations(s),this.preventSubmissionOfUnavailableLocation(s,o)}hideUnavailableLocations(e){if(!!this.vscsLocationList)if(this.advancedOptionsForm){const t=this.vscsLocationList.querySelectorAll(".select-menu-item");for(const o of t){const s=o.querySelector("input");if(s&&e.includes(s.getAttribute("data-location"))){o.removeAttribute("hidden");continue}s&&(s.removeAttribute("checked"),s.setAttribute("aria-checked","false")),o.setAttribute("hidden","hidden")}}else{const t=this.vscsLocationList.querySelectorAll(".SelectMenu-item");for(const o of t)e.includes(o.getAttribute("data-location"))?o.removeAttribute("hidden"):o.setAttribute("hidden","hidden")}}preventSubmissionOfUnavailableLocation(e,t){if(this.createCodespaceForm){const o=this.createCodespaceForm.querySelector('[name="codespace[location]"]');o&&!e.includes(o.value)&&(o.value=t,this.vscsLocationSummary&&(this.vscsLocationSummary.textContent=this.vscsLocationSummary.getAttribute("data-blank-title")))}if(this.advancedOptionsForm){const o=this.advancedOptionsForm.querySelector('[name="location"]');o&&!e.includes(o.value)&&(o.value=t),!this.advancedOptionsForm.querySelector('[name="selected_location"]:checked')&&this.autoSelectLocation&&this.autoSelectLocation.hidden&&(this.selectedLocation&&this.selectedLocation.setAttribute("hidden","hidden"),this.needsSelectedLocation&&this.needsSelectedLocation.removeAttribute("hidden"))}}vscsTargetUrlUpdated(e){const t=e.currentTarget;this.vscsTargetUrl.value=t.value}};oe(c,"NewCodespaceElement"),l([i],c.prototype,"form",2),l([i],c.prototype,"createCodespaceForm",2),l([i],c.prototype,"createCodespaceWithSkuSelectForm",2),l([i],c.prototype,"vscsTargetUrl",2),l([i],c.prototype,"vscsLocationList",2),l([i],c.prototype,"vscsLocationSummary",2),l([i],c.prototype,"loadingVscode",2),l([i],c.prototype,"vscodePoller",2),l([i],c.prototype,"advancedOptionsForm",2),l([i],c.prototype,"locationResubmitParam",2),l([i],c.prototype,"skuNameInput",2),l([i],c.prototype,"selectedLocation",2),l([i],c.prototype,"autoSelectLocation",2),l([i],c.prototype,"needsSelectedLocation",2),c=l([b],c);var se=Object.defineProperty,k=(e,t)=>se(e,"name",{value:t,configurable:!0});m("submit",".js-toggle-hidden-codespace-form",function(e){const t=e.currentTarget;f(t)}),m("click",".js-create-codespace-with-sku-button",async function(e){const t=e.currentTarget,o=t.closest("[data-target*='new-codespace.createCodespaceForm']")||t.closest("[data-target*='new-codespace.createCodespaceWithSkuSelectForm']");await _(o),o.classList.contains("js-open-in-vscode-form")?(f(o),E(o)):(o.submit(),T())});function f(e){const t=e.querySelectorAll(".js-toggle-hidden");for(const s of t)s.hidden=!s.hidden;const o=e.querySelectorAll(".js-toggle-disabled");for(const s of o)s.getAttribute("aria-disabled")?s.removeAttribute("aria-disabled"):s.setAttribute("aria-disabled","true")}k(f,"toggleFormSubmissionInFlight");function G(e){return e.closest("[data-replace-remote-form-target]")}k(G,"getFormTarget");async function T(){const e=document.querySelector(".js-codespaces-details-container");e&&(e.open=!1);const t=document.querySelector("new-codespace");if(t&&!t.getAttribute("data-no-submit-on-create"))try{const o=await fetch("/codespaces/new");if(o&&o.ok){const s=L(document,await o.text());t.replaceWith(s)}}catch{}}k(T,"createFormSubmitted"),m("submit",".js-create-codespaces-form-command",function(e){const t=e.currentTarget;t.classList.contains("js-open-in-vscode-form")||(T(),f(t),F())}),m("submit","form.js-codespaces-delete-form",async function(e){e.preventDefault();const t=e.currentTarget;try{const o=await fetch(t.action,{method:t.method,body:new FormData(t),headers:{Accept:"text/fragment+html","X-Requested-With":"XMLHttpRequest"}});if(o.ok){const s=L(document,await o.text());G(t).replaceWith(s)}else if(o.status===401)t.submit();else throw new Error(`Unexpected response: ${o.statusText}`)}finally{f(t)}}),m("submit","form.js-open-in-vscode-form",async function(e){e.preventDefault();const t=e.currentTarget;await E(t)});async function K(e,t){const o=document.querySelector(`#${e}`),s=await M({content:o.content.cloneNode(!0),dialogClass:"project-dialog"});return t&&t.setAttribute("aria-expanded","true"),s.addEventListener("dialog:remove",function(){t&&f(t)},{once:!0}),s}k(K,"openDialog");async function E(e){const t=await fetch(e.action,{method:e.method,body:new FormData(e),headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}});if(t.ok){const o=await t.json();o.codespace_url?(window.location.href=o.codespace_url,f(e),T(),F()):(e.closest("get-repo")||e.closest("new-codespace")?(e.setAttribute("data-src",o.loading_url),e.dispatchEvent(new CustomEvent("pollvscode"))):e.closest("prefetch-pane")&&(e.setAttribute("data-src",o.loading_url),e.dispatchEvent(new CustomEvent("prpollvscode"))),f(e))}else if(t.status===422){const o=await t.json();if(o.error_type==="concurrency_limit_error")await K("concurrency-error",e);else{const s=document.querySelector("template.js-flash-template"),n=o.error;s.after(new x(s,{className:"flash-error",message:n})),f(e)}}}k(E,"createCodespaceIntoVscode");async function F(){const e=document.querySelector(".js-codespaces-completable"),t=e&&e.getAttribute("data-src");if(!t)return;const o=await fetch(t,{method:"GET",headers:{Accept:"text/fragment+html","X-Requested-With":"XMLHttpRequest"}});if(o.ok){const s=L(document,await o.text());e.replaceWith(s)}else throw new Error(`Unexpected response: ${o.statusText}`)}k(F,"renderAllDone");var Q=Object.defineProperty,ne=Object.getOwnPropertyDescriptor,ie=(e,t)=>Q(e,"name",{value:t,configurable:!0}),j=(e,t,o,s)=>{for(var n=s>1?void 0:s?ne(t,o):t,r=e.length-1,a;r>=0;r--)(a=e[r])&&(n=(s?a(t,o,n):a(n))||n);return s&&n&&Q(t,o,n),n};let w=class extends HTMLElement{constructor(){super(...arguments);this.abortPoll=null}connectedCallback(){this.abortPoll=new AbortController,this.loadingIndicator.hidden||this.startPoll()}disconnectedCallback(){var e;(e=this.abortPoll)==null||e.abort()}async exportBranch(e){e.preventDefault(),this.form.hidden=!0,this.loadingIndicator.hidden=!1,(await fetch(this.form.action,{method:this.form.method,body:new FormData(this.form),headers:{Accept:"text/fragment+html","X-Requested-With":"XMLHttpRequest"}})).ok?this.startPoll():(this.form.hidden=!1,this.loadingIndicator.hidden=!0)}async startPoll(){const e=this.getAttribute("data-exported-codespace-url")||"",t=await this.poll(e);if(t)if(t.ok)this.loadingIndicator.hidden=!0,this.viewBranchLink.hidden=!1;else{const o=this.getAttribute("data-export-error-redirect-url")||"";window.location.href=o}}async poll(e,t=1e3){var o,s;if((o=this.abortPoll)==null?void 0:o.signal.aborted)return;const n=await fetch(e,{signal:(s=this.abortPoll)==null?void 0:s.signal});return n.status===202?(await new Promise(r=>setTimeout(r,t)),this.poll(e,t*1.5)):n}};ie(w,"ExportBranchElement"),j([i],w.prototype,"form",2),j([i],w.prototype,"loadingIndicator",2),j([i],w.prototype,"viewBranchLink",2),w=j([b],w);var Y=Object.defineProperty,re=Object.getOwnPropertyDescriptor,ae=(e,t)=>Y(e,"name",{value:t,configurable:!0}),g=(e,t,o,s)=>{for(var n=s>1?void 0:s?re(t,o):t,r=e.length-1,a;r>=0;r--)(a=e[r])&&(n=(s?a(t,o,n):a(n))||n);return s&&n&&Y(t,o,n),n};let p=class extends HTMLElement{reset(e){for(e.preventDefault(),this.dropdownDetails.hidden=!1,this.modalDetails.hidden=!0,this.exportDetails.hidden=!0,this.skuForm.hidden=!1;this.resultMessage.firstChild;)this.resultMessage.removeChild(this.resultMessage.firstChild);this.resultMessage.hidden=!0,this.errorMessage.hidden=!0}showSettingsModal(){this.dropdownDetails.hidden=!0,this.modalDetails.open=!0,this.modalDetails.hidden=!1}showExportModal(){this.dropdownDetails.hidden=!0,this.exportDetails.open=!0,this.exportDetails.hidden=!1,this.insertBranchExportComponent()}async insertBranchExportComponent(){const e=this.querySelector("[data-branch-export-url]");if(!e)return;const t=e.getAttribute("data-branch-export-url");if(!t)return;const o=await H(document,t);!o||(e.innerHTML="",e.appendChild(o))}};ae(p,"OptionsPopoverElement"),g([i],p.prototype,"dropdownDetails",2),g([i],p.prototype,"modalDetails",2),g([i],p.prototype,"settingsModal",2),g([i],p.prototype,"skuForm",2),g([i],p.prototype,"resultMessage",2),g([i],p.prototype,"errorMessage",2),g([i],p.prototype,"exportDetails",2),p=g([b],p);var Z=Object.defineProperty,ce=Object.getOwnPropertyDescriptor,de=(e,t)=>Z(e,"name",{value:t,configurable:!0}),h=(e,t,o,s)=>{for(var n=s>1?void 0:s?ce(t,o):t,r=e.length-1,a;r>=0;r--)(a=e[r])&&(n=(s?a(t,o,n):a(n))||n);return s&&n&&Z(t,o,n),n};let u=class extends HTMLElement{constructor(){super(...arguments);this.prefetching=!1,this.remainingRetries=3}async connectedCallback(){this.openSkuButton&&this.skipSkuButton?(await this.prefetchLocationAndSkus(),this.hideSpinner(),this.hidden=!1):this.showOpenSkuButton()}async prefetchLocationAndSkus(){const e=this.getAttribute("data-branch-has-changed")==="true";if(this.prefetching&&!e)return;const t=document.querySelector("form.js-prefetch-codespace-location")||document.querySelector("form.js-open-in-vscode-form");if(t){this.prefetching=!0;const o=await _(t);if(o&&(this.currentLocation=o.current),!this.skuSelect)return;const s=this.getAttribute("data-codespace-skus-url");if(this.currentLocation&&s){const n=await fetch(`${s}&location=${this.currentLocation}`,{headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/html_fragment"}});if(n.ok){this.setAttribute("data-branch-has-changed","false");const r=L(document,await n.text()),C=Array.from(r.querySelectorAll("input[name='codespace[sku_name]']")).filter(P=>!P.disabled),q=C.find(P=>P.checked);q&&this.defaultSkuPreview?(this.defaultSkuPreview.innerHTML=q.getAttribute("data-preview")||"",this.showSkipSkuButton()):C.length===1?(q||C[0].select(),this.showSkipSkuButton()):this.disableDropDownButton(),this.skuSelect.replaceWith(r),this.skuSelect.hidden=!1,this.skuError&&(this.skuError.hidden=!0)}else this.showOpenSkuButton(),this.remainingRetries-=1,this.remainingRetries>0&&(this.prefetching=!1),this.skuSelect.hidden=!0,this.skuError&&(this.skuError.hidden=!1)}}}showOpenSkuButton(){var e;this.shownButton===void 0&&this.openSkuButton&&(this.shownButton=this.openSkuButton,this.shownButton.hidden=!1,(e=this.skipSkuButton)==null||e.remove())}hideSpinner(){const e=document.querySelector("[data-target='codespacesCreateButtonSpinner']");e&&(e.hidden=!0)}disableDropDownButton(){this.dropdownButton&&(this.useAdvancedCreation(),this.dropdownButton.style.pointerEvents="none",this.dropdownButton.classList.add("color-fg-muted"))}showSkipSkuButton(){var e,t;if(this.shownButton===void 0&&this.skipSkuButton){this.shownButton=this.skipSkuButton,this.shownButton.hidden=!1;const o=(e=this.openSkuButton)==null?void 0:e.parentElement;o&&o instanceof HTMLDetailsElement&&(o.hidden=!0),(t=this.openSkuButton)==null||t.remove()}}toggleLoadingVscode(){if(this.loadingVscode){const e=this.loadingVscode.hidden,t=this.children;for(let o=0;o<t.length;o++)t[o].hidden=e;this.loadingVscode.hidden=!e}}pollForVscode(e){if(this.vscodePoller){this.toggleLoadingVscode();const t=e.currentTarget.getAttribute("data-src");t&&this.vscodePoller.setAttribute("src",t)}}useBasicCreation(){this.advancedOptionsLink&&(this.openSkuButton&&(this.openSkuButton.hidden=!1),this.skipSkuButton&&(this.skipSkuButton.hidden=!1),this.advancedOptionsLink&&(this.advancedOptionsLink.hidden=!0)),this.basicOptionsCheck&&this.basicOptionsCheck.classList.remove("v-hidden"),this.advancedOptionsCheck&&this.advancedOptionsCheck.classList.add("v-hidden"),this.selectionDetails.open=!1}useAdvancedCreation(){this.advancedOptionsLink&&(this.openSkuButton&&(this.openSkuButton.hidden=!0),this.skipSkuButton&&(this.skipSkuButton.hidden=!0),this.advancedOptionsLink.hidden=!1),this.basicOptionsCheck&&this.basicOptionsCheck.classList.add("v-hidden"),this.advancedOptionsCheck&&this.advancedOptionsCheck.classList.remove("v-hidden"),this.selectionDetails.open=!1}};de(u,"PrefetchPaneElement"),h([i],u.prototype,"skuSelect",2),h([i],u.prototype,"skuError",2),h([i],u.prototype,"selectionDetails",2),h([i],u.prototype,"loadingVscode",2),h([i],u.prototype,"vscodePoller",2),h([i],u.prototype,"openSkuButton",2),h([i],u.prototype,"skipSkuButton",2),h([i],u.prototype,"defaultSkuPreview",2),h([i],u.prototype,"dropdownButton",2),h([i],u.prototype,"advancedOptionsLink",2),h([i],u.prototype,"basicOptionsCheck",2),h([i],u.prototype,"advancedOptionsCheck",2),u=h([b],u);var J=Object.defineProperty,le=Object.getOwnPropertyDescriptor,ue=(e,t)=>J(e,"name",{value:t,configurable:!0}),ee=(e,t,o,s)=>{for(var n=s>1?void 0:s?le(t,o):t,r=e.length-1,a;r>=0;r--)(a=e[r])&&(n=(s?a(t,o,n):a(n))||n);return s&&n&&J(t,o,n),n};let O=class extends HTMLElement{async connectedCallback(){this.closeDetailsPopover();const e=this.getAttribute("data-codespace-url");e&&(window.location.href=e)}closeDetailsPopover(){const e=document.querySelector(".js-codespaces-details-container");e&&(e.open=!1)}};ue(O,"VscodeForwarderElement"),ee([i],O.prototype,"vscodeLink",2),O=ee([b],O)}}});
//# sourceMappingURL=codespaces-4a9d93ec.js.map
